<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OBU Server</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
        #map { height: 500px; }
        .info-container { padding: 10px; }
        
    </style>
</head>
<body>
    <div class="elc-navbar">

        <div class="container">
            <nav class="navbar navbar-expand-lg">
                  <a class="navbar-brand" href="/">
                                        <img src="https://www.elcom.com.vn/assets/web/images/logo-menu.png" class="home" alt="Elcom logo">
                                </a>
                <div class="navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ml-150 mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link has-sub text-nowrap" href="javascript:">V·ªÅ Elcom</a>
                            <ul class="sub-menu">
                                <li><a href="https://www.elcom.com.vn/gioi-thieu" title="Gi·ªõi thi·ªáu">Gi·ªõi thi·ªáu</a></li>
                                <li><a href="https://www.elcom.com.vn/lich-su-hinh-thanh" title="L·ªãch s·ª≠ h√¨nh th√†nh">L·ªãch s·ª≠ h√¨nh th√†nh</a></li>
                                <li><a href="https://www.elcom.com.vn/ban-lanh-dao" title="Ban l√£nh ƒë·∫°o">Ban l√£nh ƒë·∫°o</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link has-sub text-nowrap" href="javascript:">S·∫£n ph·∫©m</a>
                            <ul class="sub-menu">
                                <li>
                                    <a href="https://www.elcom.com.vn/san-pham/cong-nghe" title="C√¥ng ngh·ªá">C√¥ng ngh·ªá</a>
                                    <ul class="sub-menu">
                                        <li><a href="https://www.elcom.com.vn/san-pham/ai-vision" title="AI Vision">AI Vision</a></li>
    
    
                                    </ul>
                                </li>
                                <li>
                                    <a href="https://www.elcom.com.vn/san-pham/smart-traffic" title="Giao th√¥ng th√¥ng minh">Giao th√¥ng th√¥ng minh</a>
                                    <ul class="sub-menu">
                                        <li><a href="https://www.elcom.com.vn/san-pham/smart-traffic-its" title="ITS">H·ªá sinh th√°i giao th√¥ng th√¥ng minh</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/smart-traffic-itmon" title="ITMON gi√°m s√°t x·ª≠ ph·∫°t">ITMON gi√°m s√°t x·ª≠ ph·∫°t</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/smart-traffic-etc" title="ETC thu ph√≠ ƒëi·ªán t·ª≠ kh√¥ng d·ª´ng">Thu ph√≠ t·ª± ƒë·ªông</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/smart-traffic-ewim" title="eWIM ki·ªÉm so√°t t·∫£i tr·ªçng xe">Ki·ªÉm so√°t t·∫£i tr·ªçng</a></li>
                                       <!--  <li><a href="#" title="VTS">VTS</a></li> -->
                                        
                                    </ul>
                                </li>
                                <li>
                                    <a href="https://www.elcom.com.vn/san-pham/digital-transformation" title="Chuy·ªÉn ƒë·ªïi s·ªë">Chuy·ªÉn ƒë·ªïi s·ªë</a>
                                    <ul class="sub-menu">
                                        <li><a href="https://www.elcom.com.vn/san-pham/intelligence-operation-systems" title="Trung t√¢m ƒëi·ªÅu h√†nh th√¥ng minh">Trung t√¢m ƒëi·ªÅu h√†nh th√¥ng minh</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/data-platform" title="N·ªÅn t·∫£ng d·ªØ li·ªáu d√πng chung">N·ªÅn t·∫£ng d·ªØ li·ªáu d√πng chung</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/public-safety-system" title="Gi·∫£i ph√°p gi√°m s√°t an ninh tr·∫≠t t·ª±">Gi·∫£i ph√°p gi√°m s√°t an ninh tr·∫≠t t·ª±</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="https://www.elcom.com.vn/san-pham/vien-thong" title="Vi·ªÖn th√¥ng &amp; CNTT">Vi·ªÖn th√¥ng &amp; CNTT</a>
                                    <ul class="sub-menu">
                                        <li><a href="https://www.elcom.com.vn/san-pham/vrbt" title="VRBT">VRBT</a></li>
    
                                    </ul>
                                </li>
                                <li>
                                    <a href="https://www.elcom.com.vn/san-pham/an-ninh-quoc-phong" title="An ninh qu·ªëc ph√≤ng">An ninh qu·ªëc ph√≤ng</a>
                                    <ul class="sub-menu">
                                        <li><a href="https://www.elcom.com.vn/san-pham/skyeye" title="SkyEye">SkyEye ‚Äì H·ªá th·ªëng gi√°m s√°t th√¥ng tin li√™n l·∫°c v·ªá tinh</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/eyesea" title="EyeSea">EyeSea ‚Äì H·ªá th·ªëng gi√°m s√°t t√†u thuy·ªÅn</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/truyen-dan-thong-tin-lien-lac" title="Truy·ªÅn d·∫´n, th√¥ng tin li√™n l·∫°c">Truy·ªÅn d·∫´n, th√¥ng tin li√™n l·∫°c</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/an-toan-thong-tin-giam-sat-mang" title="An to√†n th√¥ng tin, gi√°m s√°t m·∫°ng">An to√†n th√¥ng tin, gi√°m s√°t m·∫°ng</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/san-pham-chuyen-dung-an-ninh-quoc-phong" title="S·∫£n ph·∫©m chuy√™n d·ª•ng an ninh qu·ªëc ph√≤ng">S·∫£n ph·∫©m chuy√™n d·ª•ng an ninh qu·ªëc ph√≤ng</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="https://www.elcom.com.vn/san-pham/dich-vu-truc-tuyen" title="D·ªãch v·ª• tr·ª±c tuy·∫øn">D·ªãch v·ª• tr·ª±c tuy·∫øn</a>
                                    <ul class="sub-menu">
                                        <li><a href="https://www.elcom.com.vn/san-pham/colearn" title="CoLearn">CoLearn</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/1sk" title="1SK">1SK</a></li>
                                        <li><a href="https://www.elcom.com.vn/san-pham/vas" title="VAS">VAS</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <!-- tin t·ª©c -->
                        <li class="nav-item">
                            <a class="nav-link text-nowrap" href="https://www.elcom.com.vn/tin-tuc" title="Tin t·ª©c">Tin t·ª©c</a>
                            
                        </li>
                        <!-- tuy·ªÉn d·ª•ng -->
                        <li class="nav-item">
                            <!-- <a class="nav-link has-sub" href="https://www.elcom.com.vn/tuyen-dung" title="Tuy·ªÉn d·ª•ng">Tuy·ªÉn d·ª•ng</a> -->
                            <a class="nav-link has-sub text-nowrap" href="javascript:" title="Tuy·ªÉn d·ª•ng">Tuy·ªÉn d·ª•ng</a>
                            <ul class="sub-menu">
                                <li><a href="https://www.elcom.com.vn/tuyen-dung" title="T√¨m ki·∫øm c∆° h·ªôi">T√¨m ki·∫øm c∆° h·ªôi</a></li>
                                <li><a href="https://www.elcom.com.vn/tuyen-dung/van-hoa-doanh-nghiep" title="VƒÉn h√≥a doanh nghi·ªáp">VƒÉn h√≥a doanh nghi·ªáp</a></li>
                               <!--  <li><a href="https://www.elcom.com.vn/tuyen-dung/cau-hoi-thuong-gap" title="C√¢u h·ªèi th∆∞·ªùng g·∫∑p">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</a></li>
                                <li><a href="https://www.elcom.com.vn/tuyen-dung/quy-trinh-tuyen-dung" title="Quy tr√¨nh tuy·ªÉn d·ª•ng">Quy tr√¨nh tuy·ªÉn d·ª•ng</a></li> -->
                            </ul>
                        </li>
                        <!-- c·ªï ƒë√¥ng -->
                        <li class="nav-item">
                            <a class="nav-link has-sub text-nowrap" href="https://www.elcom.com.vn/co-dong/phieu-thong-tin" title="C·ªï ƒë√¥ng">C·ªï ƒë√¥ng</a>
                            <ul class="sub-menu">
                                <li><a href="https://www.elcom.com.vn/co-dong/phieu-thong-tin" title="C√¥ng b·ªë th√¥ng tin">C√¥ng b·ªë th√¥ng tin</a></li>
                                <li><a href="https://www.elcom.com.vn/co-dong/bao-cao-tai-chinh" title="B√°o c√°o t√†i ch√≠nh">B√°o c√°o t√†i ch√≠nh</a></li>
                                <li><a href="https://www.elcom.com.vn/co-dong/bao-cao-thuong-nien" title="B√°o c√°o th∆∞·ªùng ni√™n">B√°o c√°o th∆∞·ªùng ni√™n</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="d-flex elc-navbar-icon ml-auto align-items-center">
                                                <li class="login-btn">
                                
                                <a class="nav-link login" href="#" data-toggle="modal" data-target="#modal-login" title="ƒêƒÉng nh·∫≠p">
                                    <img src="https://www.elcom.com.vn/assets/web/icons/icon-login.png" alt="login google icon" class="pointer img-login">
                                    ƒêƒÉng nh·∫≠p
                                </a>
                                <a class="nav-link login-scroll" href="#" data-toggle="modal" data-target="#modal-login" title="ƒêƒÉng nh·∫≠p">
                                    <img src="https://www.elcom.com.vn/assets/web/icons/icon-login-scroll.png" alt="login google icon" class="pointer img-login">
                                    ƒêƒÉng nh·∫≠p
                                </a>
                            </li>
                                            <li class="pb-1"><img src="https://www.elcom.com.vn/assets/web/icons/search-black.png" alt="menu search icon" class="pointer" style="display: none"></li>
    
                        <li class="pb-1">
                            <a href="https://www.elcom.com.vn/change-language/vi">
                                <img src="https://www.elcom.com.vn/assets/web/icons/co-vn-menu-icon.png" alt="co-vn-menu-icon" class="cross-icon">
                            </a>
                        </li>
                        <li class="pb-1">
                            <a href="https://www.elcom.com.vn/change-language/en">
                                <img src="https://www.elcom.com.vn/assets/web/icons/co-eng-menu-icon.png" alt="co-eng-menu-icon" class="cross-icon">
                            </a>
                        </li>
    
    
    
    
    
    
    
    
    
    
    
                    </ul>
                </div>
                <div class="menu-icon-mobile">
                    <img src="https://www.elcom.com.vn/assets/web/icons/menu-open-white.png" alt="menu open icon" class="pointer">
                </div>
            </nav>
        </div>
    </div>
    <h1>OBU Server - Gi√°m s√°t h√†nh tr√¨nh</h1>
    <div id="map"></div>
    <div class="info-container">
        <input type="search" id="deviceName" placeholder="Nh·∫≠p t√™n thi·∫øt b·ªã...">
        <button onclick="searchDevice()">üîç</button>
        <p><strong>T·ªça ƒë·ªô:</strong> <span id="coords"></span></p>
        <p><strong>Chi ph√≠:</strong> <span id="cost"></span> VND</p>
    </div>
    
    <script>
        var map = L.map('map').setView([21.0285, 105.8542], 12);
        L.tileLayer('https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            attribution: '&copy; Google Maps'
        }).addTo(map);
        
        var markers = {};
        var paths = {};

        function updateMarker(lat, lng, deviceName) {
            if (!markers[deviceName]) {
                markers[deviceName] = L.marker([lat, lng]).addTo(map)
                    .bindPopup("Thi·∫øt b·ªã: " + deviceName);
                paths[deviceName] = L.polyline([], { color: 'blue' }).addTo(map);
            }
            markers[deviceName].setLatLng([lat, lng]).openPopup();
            paths[deviceName].addLatLng([lat, lng]);
            document.getElementById("coords").innerText = lat + ", " + lng;
        }
        
        function searchDevice() {
            var inputName = document.getElementById("deviceName").value.trim();
            if (markers[inputName]) {
                map.setView(markers[inputName].getLatLng(), 15);
                markers[inputName].openPopup();
            } else {
                alert("Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã!");
            }
        }
        
        const client = mqtt.connect("wss://test.mosquitto.org:8081");

        client.on("connect", function () {
            console.log("ƒê√£ k·∫øt n·ªëi MQTT");
            client.subscribe("elcom/obu/#");
        });

        client.on("message", function (topic, message) {
            try {
                let data = JSON.parse(message.toString());
                let deviceName = data.device;
                let lat = data.lat;
                let lng = data.lng;
                updateMarker(lat, lng, deviceName);
            } catch (error) {
                console.error("L·ªói x·ª≠ l√Ω d·ªØ li·ªáu MQTT:", error);
            }
        });
    </script>
</body>
</html>
